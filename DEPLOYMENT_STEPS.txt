#!/bin/bash
# SETTLE-UP FIRESTORE DEPLOYMENT STEPS
# Follow these exact steps to deploy your database

echo "╔════════════════════════════════════════════════════════════════╗"
echo "║          SETTLE-UP FIRESTORE DEPLOYMENT                       ║"
echo "╚════════════════════════════════════════════════════════════════╝"
echo ""

echo "✅ PREREQUISITE CHECK:"
echo "  ✓ Node.js 20.19.6"
echo "  ✓ Firebase CLI 15.1.0"
echo "  ✓ Project files ready"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "STEP 1: CREATE FIREBASE PROJECT (5 minutes)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "1. Open: https://console.firebase.google.com"
echo "2. Click 'Create a project'"
echo "3. Name it: settle-up"
echo "4. Disable Google Analytics"
echo "5. Click 'Create project'"
echo "6. Wait for project to be created (~2 minutes)"
echo ""
echo "⏸️  PAUSE HERE until Step 2 is complete"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "STEP 2: ENABLE FIRESTORE DATABASE (3 minutes)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "1. In Firebase Console, select your 'settle-up' project"
echo "2. Left sidebar → 'Build' → 'Firestore Database'"
echo "3. Click 'Create Database'"
echo "4. Choose region: us-central1"
echo "5. Select 'Start in production mode'"
echo "6. Click 'Enable'"
echo "7. Wait for Firestore to be created (~1-2 minutes)"
echo ""
echo "⏸️  PAUSE HERE until Firestore shows green checkmark"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "STEP 3: DEPLOY TO FIREBASE (2 minutes)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "Copy and paste these commands in your terminal:"
echo ""
echo "────────────────────────────────────────────────────────────────"
echo ""
echo "# Step 3a: Setup Node 20"
echo "source ~/.nvm/nvm.sh && nvm use 20"
echo ""
echo "# Step 3b: Login to Firebase"
echo "firebase login"
echo ""
echo "# Step 3c: Link your project"
echo "firebase use --add"
echo "# → Select 'settle-up' project"
echo "# → Give alias: default"
echo ""
echo "# Step 3d: Deploy indexes"
echo "firebase deploy --only firestore:indexes"
echo ""
echo "# Step 3e: Deploy security rules"
echo "firebase deploy --only firestore:rules"
echo ""
echo "────────────────────────────────────────────────────────────────"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "STEP 4: VERIFY DEPLOYMENT"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "After deployment, verify in Firebase Console:"
echo ""
echo "1. Go to https://console.firebase.google.com"
echo "2. Select 'settle-up' project"
echo "3. Go to 'Firestore Database'"
echo "4. Check 'Rules' tab - should show your custom rules"
echo "5. Check 'Indexes' tab - should show 3 indexes:"
echo "   • expenses.createdBy + date"
echo "   • balances.payerId + settled"
echo "   • balances.payeeId + settled"
echo ""
echo "If you see all 3 indexes deployed: ✅ SUCCESS!"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "WHAT'S NEXT"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "✅ Step 1: Firestore Database - DEPLOYED"
echo ""
echo "Next steps:"
echo "  1. Deploy Cloud Functions: firebase deploy --only functions"
echo "  2. Build your frontend"
echo "  3. Test end-to-end flows"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "TROUBLESHOOTING"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "If 'firebase login' doesn't work:"
echo "  1. firebase logout"
echo "  2. firebase login"
echo ""
echo "If 'Project not found' error:"
echo "  1. Make sure you created Firebase project first"
echo "  2. firebase use --add (and select correct project)"
echo ""
echo "Need help? See FIREBASE_DEPLOY_QUICK.md"
echo ""

echo "✨ Ready to start? Begin with Step 1 above! ✨"
